<div class="flex h-screen w-full bg-gray-100">
  <div class="h-full w-fit bg-white shadow-lg">
    <app-chat-bar (userSelected)="onUserSelected($event)"></app-chat-bar>
  </div>

  <div class="flex flex-1 justify-center items-center relative bg-gray-50">
    @if (selectedUser) {
    <div class="flex flex-col h-full w-full p-6 max-h-screen">
      <div
        class="flex items-center space-x-4 border-b pb-4 mb-4 bg-white shadow-sm rounded-xl p-4 shrink-0"
      >
        <img
          [src]="selectedUser.imageUrl"
          alt="Photo de {{ selectedUser.nom }}"
          class="w-12 h-12 rounded-full object-cover"
        />
        <h2 class="text-xl font-bold text-gray-800">{{ selectedUser.nom }}</h2>
      </div>

      <div
        class="flex-1 min-h-0 overflow-y-auto p-4 space-y-3 rounded-xl bg-white shadow-sm"
        #scrollContainer
        (scroll)="onScroll()"
      >
        @for (msg of messageConv().content; track $index) {
        <div class="flex w-full">
          <div
            [ngClass]="{
              'ml-auto bg-purple-600 text-white': msg.senderId == currentUserId,
              'bg-gray-200 text-gray-800': msg.senderId !== currentUserId
            }"
            class="rounded-2xl p-3 max-w-[60%] wrap-break-word"
          >
            {{ msg.message }}
          </div>
        </div>
        }
      </div>

      <div class="mt-4 flex items-center space-x-3 shrink-0">
        <input
          [formControl]="newMessage"
          type="text"
          placeholder="write a message..."
          class="flex-1 border rounded-full px-4 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500"
        />
        <button
          type="button"
          (click)="sendMessage()"
          class="bg-purple-600 text-white px-4 py-2 rounded-full hover:bg-purple-700 transition"
        >
          Envoyer
        </button>
      </div>
    </div>
    }
  </div>

  <div class="h-full w-fit bg-gray-50">
    <app-user-menu></app-user-menu>
  </div>
</div>
